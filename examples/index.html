<!DOCTYPE html>
<html>
<head>
<title>Vecnik - Leaflet</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="lib/leaflet/leaflet.css">
<style type="text/css">
html, body {
  border: 0;
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
#map {
  height: 100%;
}
</style>
<script src="lib/leaflet/leaflet-src.js"></script>

<script src="../src/core.js"></script>
<script src="../src/settings.js"></script>
<script src="../src/mercator.js"></script>
<script src="../src/geometry.js"></script>
<script src="../src/model.js"></script>
<script src="../src/renderer.js"></script>
<script src="../src/shader.js"></script>

<script src="../src/cartodb.sql.js"></script>
<script src="../src/cartodb.provider.js"></script>

<script src="../src/tileloader.js"></script>
<script src="../src/vecnik.leaflet.js"></script>

<script src="lib/underscore.js"></script>
<script src="lib/carto.js"></script>

<!--
<script src="lib/modestmaps.js"></script>
<script src="../src/vecnik.modestmaps.js"></script>
-->

<script src="../src/carto.js"></script>
</head>

<body>
<div id="map"></div>

<script>
var map = new L.Map('map').setView([40.877832, -73.910919], 18);
new L.TileLayer('http://otile2.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png', { maxNativeZoom: 19, maxZoom: 21 }).addTo(map);

//VECNIK.Carto.init(function(carto) {
//  VECNIK.Carto.compile(
//    "#world { line-width: 2; line-color: #f00; [TYPEY='test']{ line-width: 2; } [ZOOM = 0]{ line-width: 2; } }"
//    , function() {})
//});
//
//VECNIK.settings.set({
//   ENABLE_CLIPPING: true,
//   ENABLE_SIMPLIFY: true,
//   ENABLE_FIXING: true,
//   ENABLE_SNAPPING: true
//});
//
//var provider = new VECNIK.CartoDB.API({
//  user: 'viz2',
//  table: 'ny',
//  debug: true
//});
//
//var shader = new VECNIK.CartoShader({
//  'point-color': '#fff',
//  'line-color': '#F00',
//  'line-width': function() {
//    return 3;
//  },
//  'polygon-fill': function() {
//    return 'rgba(200, 200, 200, 0.8)';
//  }
//});

//var vecnikLayer = new VECNIK.CanvasProvider(provider, shader, new SketchRender());
//var vecnikLayer = new VECNIK(map, provider);

var VecnikLayer = L.CanvasLayer.extend({
  renderCircle: function(ctx, point, radius) {
    ctx.fillStyle = 'rgba(255, 60, 60, 0.2)';
    ctx.strokeStyle = 'rgba(255, 60, 60, 0.9)';
    ctx.beginPath();
    ctx.arc(point.x, point.y, radius, 0, Math.PI * 2.0, true, true);
    ctx.closePath();
    ctx.fill();
    ctx.stroke();
  },

  render: function() {
    var canvas = this.getCanvas();
    var ctx = canvas.getContext('2d');

    // clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // get center from the map (projected)
    var point = this._map.latLngToContainerPoint(new L.LatLng(0, 0));

    // render
    this.renderCircle(ctx, point, (1.0 + Math.sin(Date.now()*0.001))*300);

    this.redraw();
  }
});

var vlayer = new VecnikLayer().addTo(map);
L.control.layers({}, { VECNIK: vlayer }).addTo(map);
</script>
</body>
</html>