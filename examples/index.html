<!DOCTYPE html>
<html>
<head>
<title>Vecnik - Leaflet</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="lib/leaflet/leaflet.css">
<style type="text/css">
html, body {
  border: 0;
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
#map {
  height: 100%;
}
</style>
<script src="lib/leaflet/leaflet-src.js"></script>

<script src="../src/core.js"></script>
<script src="../src/settings.js"></script>
<script src="../src/mercator.js"></script>
<script src="../src/geometry.js"></script>
<script src="../src/models.js"></script>
<script src="../src/tile.js"></script>
<script src="../src/renderer.js"></script>
<script src="../src/shader.js"></script>

<script src="../src/provider/cartodb.sql.js"></script>
<script src="../src/provider/cartodb.js"></script>

<script src="../src/map/leaflet.tiles.js"></script>
<script src="../src/map/leaflet.js"></script>

<script src="lib/underscore.js"></script>
<script src="lib/carto.js"></script>

<script src="../src/carto.js"></script>
</head>

<body>
<div id="map"></div>

<script>
var map = new L.Map('map').setView([40.735291, -73.990731], 16);
new L.TileLayer('http://otile2.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png', { maxNativeZoom: 19, maxZoom: 21 }).addTo(map);

var provider = new VECNIK.CartoDB.API({
  user: 'pluto',
  table: 'mn_mappluto_13v1',
  debug: true
});

var renderer = new VECNIK.Renderer();

//var VecnikLayer = L.CanvasLayer.extend({
//  render: function() {
//    var canvas = this.getCanvas();
//    var ctx = canvas.getContext('2d');
//    ctx.clearRect(0, 0, canvas.width, canvas.height);
//    this.redraw();
//  }
//});

var vlayer = new L.CanvasLayer({
  provider: provider,
  renderer: renderer
}).addTo(map);
L.control.layers({}, { VECNIK: vlayer }).addTo(map);

//VECNIK.Carto.init(function(carto) {
//  VECNIK.Carto.compile(
//    "#world { line-width: 2; line-color: #f00; [TYPEY='test']{ line-width: 2; } [ZOOM = 0]{ line-width: 2; } }",
//    function() {}
//  );
//});
//
//var shader = new VECNIK.CartoShader({
//  'point-color': '#fff',
//  'line-color': '#F00',
//  'line-width': function(data) {
//    return '3';
//  },
//  'polygon-fill': function(data) {
//    return "rgba(200, 200, 200, 0.8)";
//  }
//});

</script>
</body>
</html>